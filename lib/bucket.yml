AWSTemplateFormatVersion: 2010-09-09
#Metadata:
Resources:
  BuildBucket:
    Type: "AWS::S3::Bucket"
#    Properties: 
      #BucketName: String # Omit BucketName to generate a unique name automatically
  BuildBucketUser:
    Type: AWS::IAM::User
    Properties:
      Path: /
      Policies:
        - PolicyName: BuildBucketPolicy
          PolicyDocument:
            Version: 2012-10-17
            Statement:
              - Effect: Allow
                Action:
                  - s3:GetObject
                  - s3:PutObject
                  - s3:DeleteObject
                  - s3:ListBucket
                  - s3:ListObjects
                Resource:
                  - !GetAtt BuildBucket.Arn
                  - !Join [ "", [ !GetAtt BuildBucket.Arn, "/*" ] ]
  BuildBucketUserAccessKey:
    Type: AWS::IAM::AccessKey
    Properties:
      UserName: !Ref BuildBucketUser
#Parameters:
Outputs:
  BucketName:
    Description: The name of the build bucket.
    Value: !Ref BuildBucket
  BucketAccessKey:
    Description: An access key to use to push to the build bucket.
    Value: !Ref BuildBucketUserAccessKey
  BucketSecretAccessKey:
    Description: A secret access key to use to push to the build bucket.
    Value: !GetAtt BuildBucketUserAccessKey.SecretAccessKey
